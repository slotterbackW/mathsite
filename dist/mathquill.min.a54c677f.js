parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"KrXY":[function(require,module,exports) {
function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}!function(){function e(){}function n(t){var e=t.length-1;return function(){var n=vt.call(arguments,0,e),i=vt.call(arguments,e);return t.apply(this,n.concat([i]))}}function i(t){return n(function(e,n){"function"!=typeof e&&(e=wt(e));return t.call(this,function(t){return e.apply(t,[t].concat(n))})})}function s(t){var e=vt.call(arguments,1);return function(){return t.apply(this,e)}}function r(t,e){if(!e)throw new Error("prayer failed: "+t)}function o(t){r("a direction was passed",t===xt||t===yt)}function a(t,e,n){r("a parent is always present",t),r("leftward is properly set up",e?e[yt]===n&&e.parent===t:t.ends[xt]===n),r("rightward is properly set up",n?n[xt]===e&&n.parent===t:t.ends[yt]===e)}function l(){window.console&&console.warn('You are using the MathQuill API without specifying an interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')}function c(t){return l(),ht(t)}function u(t){function n(t){var e,n;return t&&t.nodeType?(n=(e=Ot(t).children(".mq-root-block").attr(mt))&&jt.byId[e].controller)?s[n.KIND_OF_MQ](n):null:null}function i(t,e){var n,i,r;for(n in e&&e.handlers&&(e.handlers={fns:e.handlers,APIClasses:s}),e)e.hasOwnProperty(n)&&(i=e[n],r=At[n],t[n]=r?r(i):i)}var s,r,o;if(!(t>=b&&v>=t))throw"Only interface versions between "+b+" and "+v+" supported. You specified: "+t;for(o in s={},n.L=xt,n.R=yt,n.config=function(t){return i(Et.p,t),this},n.registerEmbed=function(t,e){if(!/^[a-z][a-z0-9]*$/i.test(t))throw"Embed name must start with letter and be only letters and digits";It[t]=e},r=s.AbstractMathQuill=qt(Rt,function(t){t.init=function(t){this.__controller=t,this.__options=t.options,this.id=t.id,this.data=t.data},t.__mathquillify=function(t){var e,n=this.__controller,i=n.root,s=n.container;n.createTextarea(),e=s.addClass(t).contents().detach(),i.jQ=Ot('<span class="mq-root-block"/>').attr(mt,i.id).appendTo(s),this.latex(e.text()),this.revert=function(){return s.empty().unbind(".mathquill").removeClass("mq-editable-field mq-math-mode mq-text-mode").append(e)}},t.config=function(t){return i(this.__options,t),this},t.el=function(){return this.__controller.container[0]},t.text=function(){return this.__controller.exportText()},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexMath(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()},t.html=function(){return this.__controller.root.jQ.html().replace(/ mathquill-(?:command|block)-id="?\d+"?/g,"").replace(/<span class="?mq-cursor( mq-blink)?"?>.?<\/span>/i,"").replace(/ mq-hasCursor|mq-hasCursor ?/,"").replace(/ class=(""|(?= |>))/g,"")},t.reflow=function(){return this.__controller.root.postOrder("reflow"),this}}),n.prototype=r.prototype,s.EditableField=qt(r,function(t,n){t.__mathquillify=function(){return n.__mathquillify.apply(this,arguments),this.__controller.editable=!0,this.__controller.delegateMouseEvents(),this.__controller.editablesTextareaEvents(),this},t.focus=function(){return this.__controller.textarea.focus(),this},t.blur=function(){return this.__controller.textarea.blur(),this},t.write=function(t){return this.__controller.writeLatex(t),this.__controller.scrollHoriz(),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this},t.cmd=function(t){var e,n=this.__controller.notify(),i=n.cursor;return/^\\[a-z]+$/i.test(t)?(t=t.slice(1),(e=Tt[t])&&(t=e(t),i.selection&&t.replaces(i.replaceSelection()),t.createLeftOf(i.show()),this.__controller.scrollHoriz())):i.parent.write(i,t),n.blurred&&i.hide().parent.blur(),this},t.select=function(){var t=this.__controller;for(t.notify("move").cursor.insAtRightEnd(t.root);t.cursor[xt];)t.selectLeft();return this},t.clearSelection=function(){return this.__controller.cursor.clearSelection(),this},t.moveToDirEnd=function(t){return this.__controller.notify("move").cursor.insAtDirEnd(t,this.__controller.root),this},t.moveToLeftEnd=function(){return this.moveToDirEnd(xt)},t.moveToRightEnd=function(){return this.moveToDirEnd(yt)},t.keystroke=function(t){var n;for(t=t.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<t.length;n+=1)this.__controller.keystroke(t[n],{preventDefault:e});return this},t.typedText=function(t){for(var e=0;e<t.length;e+=1)this.__controller.typedText(t.charAt(e));return this},t.dropEmbedded=function(t,e,n){var i=t-Ot(window).scrollLeft(),s=e-Ot(window).scrollTop(),r=document.elementFromPoint(i,s);this.__controller.seek(Ot(r),t,e),ut().setOptions(n).createLeftOf(this.__controller.cursor)}}),n.EditableField=function(){throw"wtf don't call me, I'm 'abstract'"},n.EditableField.prototype=s.EditableField.prototype,Lt)!function(e,i){var r=s[e]=i(s);n[e]=function(i,s){var o,a=n(i);return a instanceof r||!i||!i.nodeType?a:((o=St(r.RootBlock(),Ot(i),Et())).KIND_OF_MQ=e,r(o).__mathquillify(s,t))},n[e].prototype=r.prototype}(o,Lt[o]);return n}function h(t){var e,n="moveOutOf deleteOutOf selectOutOf upOutOf downOutOf".split(" ");for(e=0;e<n.length;e+=1)!function(e){t[e]=function(t){this.controller.handle(e,t)}}(n[e]);t.reflow=function(){this.controller.handle("reflow"),this.controller.handle("edited"),this.controller.handle("edit")}}function f(t,e,n){return qt(_,{ctrlSeq:t,htmlTemplate:"<"+e+" "+n+">&0</"+e+">"})}function p(t){var e=this.parent,n=t;do{if(n[yt])return t.insLeftOf(e);n=n.parent.parent}while(n!==e);t.insRightOf(e)}function d(t,e){t.jQadd=function(){e.jQadd.apply(this,arguments),this.delimjQs=this.jQ.children(":first").add(this.jQ.children(":last")),this.contentjQ=this.jQ.children(":eq(1)")},t.reflow=function(){var t=this.contentjQ.outerHeight()/parseFloat(this.contentjQ.css("fontSize"));Y(this.delimjQs,gt(1+.2*(t-1),1.2),1.2*t)}}function m(t,e){e=e||t;var n=lt[t],i=lt[e];Ct[t]=s(at,xt,t,n,e,i),Ct[n]=s(at,yt,t,n,e,i)}var g,b,v,w,q,x,y,O,k,j,Q,T,C,D,_,S,L,E,A,R,I,z,M,B,F,$,N,P,U,W,H,G,K,Y,X,Z,V,J,tt,et,nt,it,st,rt,ot,at,lt,ct,ut,ht,ft,pt=window.jQuery,dt="mathquill-command-id",mt="mathquill-block-id",gt=Math.min,bt=Math.max,vt=[].slice,wt=n(function(t,e){return n(function(n,i){return t in n?n[t].apply(n,e.concat(i)):void 0})}),qt=function(e,n,i){function s(e){return"object"==t(e)}function r(t){return"function"==typeof t}function o(){}return function t(i,a){function l(){var t=new c;return r(t.init)&&t.init.apply(t,arguments),t}function c(){}var u,h,f;return void 0===a&&(a=i,i=Object),l.Bare=c,u=o[e]=i[e],(h=c[e]=l[e]=l.p=new o).constructor=l,l.mixin=function(n){return c[e]=l[e]=t(l,n)[e],l},(l.open=function(t){if(f={},r(t)?f=t.call(l,h,u,l,i):s(t)&&(f=t),s(f))for(var e in f)n.call(f,e)&&(h[e]=f[e]);return r(h.init)||(h.init=i),l})(a)}}("prototype",{}.hasOwnProperty),xt=-1,yt=1,Ot=qt(pt,function(t){t.insDirOf=function(t,e){return t===xt?this.insertBefore(e.first()):this.insertAfter(e.last())},t.insAtDirEnd=function(t,e){return t===xt?this.prependTo(e):this.appendTo(e)}}),kt=qt(function(t){t.parent=0,t[xt]=0,t[yt]=0,t.init=function(t,e,n){this.parent=t,this[xt]=e,this[yt]=n},this.copy=function(t){return kt(t.parent,t[xt],t[yt])}}),jt=qt(function(t){t[xt]=0,t[yt]=0,t.parent=0;var e=0;this.byId={},t.init=function(){this.id=e+=1,jt.byId[this.id]=this,this.ends={},this.ends[xt]=0,this.ends[yt]=0},t.dispose=function(){delete jt.byId[this.id]},t.toString=function(){return"{{ MathQuill Node #"+this.id+" }}"},t.jQ=Ot(),t.jQadd=function(t){return this.jQ=this.jQ.add(t)},t.jQize=function(t){function e(t){var n,i;for(t.getAttribute&&(n=t.getAttribute("mathquill-command-id"),i=t.getAttribute("mathquill-block-id"),n&&jt.byId[n].jQadd(t),i&&jt.byId[i].jQadd(t)),t=t.firstChild;t;t=t.nextSibling)e(t)}var n;for(t=Ot(t||this.html()),n=0;n<t.length;n+=1)e(t[n]);return t},t.createDir=function(t,e){o(t);var n=this;return n.jQize(),n.jQ.insDirOf(t,e.jQ),e[t]=n.adopt(e.parent,e[xt],e[yt]),n},t.createLeftOf=function(t){return this.createDir(xt,t)},t.selectChildren=function(t,e){return _t(t,e)},t.bubble=i(function(t){var e;for(e=this;e&&!1!==t(e);e=e.parent);return this}),t.postOrder=i(function(t){return function e(n){n.eachChild(e),t(n)}(this),this}),t.isEmpty=function(){return 0===this.ends[xt]&&0===this.ends[yt]},t.children=function(){return Qt(this.ends[xt],this.ends[yt])},t.eachChild=function(){var t=this.children();return t.each.apply(t,arguments),this},t.foldChildren=function(t,e){return this.children().fold(t,e)},t.withDirAdopt=function(t,e,n,i){return Qt(this,this).withDirAdopt(t,e,n,i),this},t.adopt=function(t,e,n){return Qt(this,this).adopt(t,e,n),this},t.disown=function(){return Qt(this,this).disown(),this},t.remove=function(){return this.jQ.remove(),this.postOrder("dispose"),this.disown()}}),Qt=qt(function(t){t.init=function(t,e,n){if(n===g&&(n=xt),o(n),r("no half-empty fragments",!t==!e),this.ends={},t){r("withDir is passed to Fragment",t instanceof jt),r("oppDir is passed to Fragment",e instanceof jt),r("withDir and oppDir have the same parent",t.parent===e.parent),this.ends[n]=t,this.ends[-n]=e;var i=this.fold([],function(t,e){return t.push.apply(t,e.jQ.get()),t});this.jQ=this.jQ.add(i)}},t.jQ=Ot(),t.withDirAdopt=function(t,e,n,i){return t===xt?this.adopt(e,n,i):this.adopt(e,i,n)},t.adopt=function(t,e,n){var i,s,r;return a(t,e,n),(i=this).disowned=!1,(s=i.ends[xt])?(r=i.ends[yt],e||(t.ends[xt]=s),n?n[xt]=r:t.ends[yt]=r,i.ends[yt][yt]=n,i.each(function(n){n[xt]=e,n.parent=t,e&&(e[yt]=n),e=n}),i):this},t.disown=function(){var t,e,n=this,i=n.ends[xt];return!i||n.disowned?n:(n.disowned=!0,t=n.ends[yt],a(e=i.parent,i[xt],i),a(e,t,t[yt]),i[xt]?i[xt][yt]=t[yt]:e.ends[xt]=t[yt],t[yt]?t[yt][xt]=i[xt]:e.ends[yt]=i[xt],n)},t.remove=function(){return this.jQ.remove(),this.each("postOrder","dispose"),this.disown()},t.each=i(function(t){var e=this,n=e.ends[xt];if(!n)return e;for(;n!==e.ends[yt][yt]&&!1!==t(n);n=n[yt]);return e}),t.fold=function(t,e){return this.each(function(n){t=e.call(this,t,n)}),t}}),Tt={},Ct={},Dt=qt(kt,function(t){t.init=function(t,e){this.parent=t,this.options=e;var n=this.jQ=this._jQ=Ot('<span class="mq-cursor">&#8203;</span>');this.blink=function(){n.toggleClass("mq-blink")},this.upDownCache={}},t.show=function(){return this.jQ=this._jQ.removeClass("mq-blink"),"intervalId"in this?clearInterval(this.intervalId):(this[yt]?this.selection&&this.selection.ends[xt][xt]===this[xt]?this.jQ.insertBefore(this.selection.jQ):this.jQ.insertBefore(this[yt].jQ.first()):this.jQ.appendTo(this.parent.jQ),this.parent.focus()),this.intervalId=setInterval(this.blink,500),this},t.hide=function(){return"intervalId"in this&&clearInterval(this.intervalId),delete this.intervalId,this.jQ.detach(),this.jQ=Ot(),this},t.withDirInsertAt=function(t,e,n,i){var s=this.parent;this.parent=e,this[t]=n,this[-t]=i,s!==e&&s.blur&&s.blur()},t.insDirOf=function(t,e){return o(t),this.jQ.insDirOf(t,e.jQ),this.withDirInsertAt(t,e.parent,e[t],e),this.parent.jQ.addClass("mq-hasCursor"),this},t.insLeftOf=function(t){return this.insDirOf(xt,t)},t.insRightOf=function(t){return this.insDirOf(yt,t)},t.insAtDirEnd=function(t,e){return o(t),this.jQ.insAtDirEnd(t,e.jQ),this.withDirInsertAt(t,e,0,e.ends[t]),e.focus(),this},t.insAtLeftEnd=function(t){return this.insAtDirEnd(xt,t)},t.insAtRightEnd=function(t){return this.insAtDirEnd(yt,t)},t.jumpUpDown=function(t,e){var n,i,s=this;s.upDownCache[t.id]=kt.copy(s),(n=s.upDownCache[e.id])?n[yt]?s.insLeftOf(n[yt]):s.insAtRightEnd(n.parent):(i=s.offset().left,e.seek(i,s))},t.offset=function(){var t=this.jQ.removeClass("mq-cursor").offset();return this.jQ.addClass("mq-cursor"),t},t.unwrapGramp=function(){var t=this.parent.parent,e=t.parent,n=t[yt],i=t[xt];if(t.disown().eachChild(function(s){s.isEmpty()||(s.children().adopt(e,i,n).each(function(e){e.jQ.insertBefore(t.jQ.first())}),i=s.ends[yt])}),!this[yt])if(this[xt])this[yt]=this[xt][yt];else for(;!this[yt];){if(this.parent=this.parent[yt],!this.parent){this[yt]=t[yt],this.parent=e;break}this[yt]=this.parent.ends[xt]}this[yt]?this.insLeftOf(this[yt]):this.insAtRightEnd(e),t.jQ.remove(),t[xt].siblingDeleted&&t[xt].siblingDeleted(this.options,yt),t[yt].siblingDeleted&&t[yt].siblingDeleted(this.options,xt)},t.startSelection=function(){var t,e=this.anticursor=kt.copy(this),n=e.ancestors={};for(t=e;t.parent;t=t.parent)n[t.parent.id]=t},t.endSelection=function(){delete this.anticursor},t.select=function(){var t,e,n,i,s,o,a,l=this.anticursor;if(this[xt]===l[xt]&&this.parent===l.parent)return!1;for(t=this;t.parent;t=t.parent)if(t.parent.id in l.ancestors){e=t.parent;break}if(r("cursor and anticursor in the same tree",e),n=l.ancestors[e.id],o=yt,t[xt]!==n)for(a=t;a;a=a[yt])if(a[yt]===n[yt]){o=xt,i=t,s=n;break}return o===yt&&(i=n,s=t),i instanceof kt&&(i=i[yt]),s instanceof kt&&(s=s[xt]),this.hide().selection=e.selectChildren(i,s),this.insDirOf(o,this.selection.ends[o]),this.selectionChanged(),!0},t.clearSelection=function(){return this.selection&&(this.selection.clear(),delete this.selection,this.selectionChanged()),this},t.deleteSelection=function(){this.selection&&(this[xt]=this.selection.ends[xt][xt],this[yt]=this.selection.ends[yt][yt],this.selection.remove(),this.selectionChanged(),delete this.selection)},t.replaceSelection=function(){var t=this.selection;return t&&(this[xt]=t.ends[xt][xt],this[yt]=t.ends[yt][yt],delete this.selection),t}}),_t=qt(Qt,function(t,e){t.init=function(){e.init.apply(this,arguments),this.jQ=this.jQ.wrapAll('<span class="mq-selection"></span>').parent()},t.adopt=function(){return this.jQ.replaceWith(this.jQ=this.jQ.children()),e.adopt.apply(this,arguments)},t.clear=function(){return this.jQ.replaceWith(this.jQ[0].childNodes),this},t.join=function(t){return this.fold("",function(e,n){return e+n[t]()})}}),St=qt(function(t){t.init=function(t,e,n){this.id=t.id,this.data={},this.root=t,this.container=e,this.options=n,t.controller=this,this.cursor=t.cursor=Dt(t,n)},t.handle=function(t,e){var n,i=this.options.handlers;i&&i.fns[t]&&(n=i.APIClasses[this.KIND_OF_MQ](this),e===xt||e===yt?i.fns[t](e,n):i.fns[t](n))};var e=[];this.onNotify=function(t){e.push(t)},t.notify=function(){for(var t=0;t<e.length;t+=1)e[t].apply(this.cursor,arguments);return this}}),Lt={},Et=qt(),At={},Rt=qt(),It={};for($ in c.prototype=Rt.p,c.interfaceVersion=function(t){if(1!==t)throw"Only interface version 1 supported. You specified: "+t;return(l=function(){window.console&&console.warn('You called MathQuill.interfaceVersion(1); to specify the interface version, which will fail in v1.0.0. You can fix this easily by doing this before doing anything else:\n\n    MathQuill = MathQuill.getInterface(1);\n    // now MathQuill.MathField() works like it used to\n\nSee also the "`dev` branch (2014–2015) → v0.10.0 Migration Guide" at\n  https://github.com/mathquill/mathquill/wiki/%60dev%60-branch-(2014%E2%80%932015)-%E2%86%92-v0.10.0-Migration-Guide')})(),c},c.getInterface=u,b=u.MIN=1,v=u.MAX=2,c.noConflict=function(){return window.MathQuill=w,c},w=window.MathQuill,window.MathQuill=c,q=qt(function(t,e,n){function i(t,e){throw"Parse Error: "+e+" at "+(t=t?"'"+t+"'":"EOF")}var s,o,a;t.init=function(t){this._=t},t.parse=function(t){return this.skip(a)._(""+t,function(t,e){return e},i)},t.or=function(t){r("or is passed a parser",t instanceof n);var e=this;return n(function(n,i,s){return e._(n,i,function(e){return t._(n,i,s)})})},t.then=function(t){var e=this;return n(function(i,s,o){return e._(i,function(e,i){var a=t instanceof n?t:t(i);return r("a parser is returned",a instanceof n),a._(e,s,o)},o)})},t.many=function(){var t=this;return n(function(e,n,i){function s(t,n){return e=t,o.push(n),!0}function r(){return!1}for(var o=[];t._(e,s,r););return n(e,o)})},t.times=function(t,e){arguments.length<2&&(e=t);var i=this;return n(function(n,s,r){function o(t,e){return h.push(e),n=t,!0}function a(t,e){return c=e,n=t,!1}function l(t,e){return!1}var c,u,h=[],f=!0;for(u=0;t>u;u+=1)if(!(f=i._(n,o,a)))return r(n,c);for(;e>u&&f;u+=1)f=i._(n,o,l);return s(n,h)})},t.result=function(t){return this.then(o(t))},t.atMost=function(t){return this.times(0,t)},t.atLeast=function(t){var e=this;return e.times(t).then(function(t){return e.many().map(function(e){return t.concat(e)})})},t.map=function(t){return this.then(function(e){return o(t(e))})},t.skip=function(t){return this.then(function(e){return t.result(e)})},this.string=function(t){var e=t.length,i="expected '"+t+"'";return n(function(n,s,r){var o=n.slice(0,e);return o===t?s(n.slice(e),o):r(n,i)})},s=this.regex=function(t){r("regexp parser is anchored","^"===t.toString().charAt(1));var e="expected "+t;return n(function(n,i,s){var r,o=t.exec(n);return o?(r=o[0],i(n.slice(r.length),r)):s(n,e)})},o=n.succeed=function(t){return n(function(e,n){return n(e,t)})},n.fail=function(t){return n(function(e,n,i){return i(e,t)})},n.letter=s(/^[a-z]/i),n.letters=s(/^[a-z]*/i),n.digit=s(/^[0-9]/),n.digits=s(/^[0-9]*/),n.whitespace=s(/^\s+/),n.optWhitespace=s(/^\s*/),n.any=n(function(t,e,n){return t?e(t.slice(1),t.charAt(0)):n(t,"expected any character")}),n.all=n(function(t,e,n){return e("",t)}),a=n.eof=n(function(t,e,n){return t?n(t,"expected EOF"):e(t,t)})}),x=function(){function t(t){var e,i=t.which||t.keyCode,s=n[i],r=[];return t.ctrlKey&&r.push("Ctrl"),t.originalEvent&&t.originalEvent.metaKey&&r.push("Meta"),t.altKey&&r.push("Alt"),t.shiftKey&&r.push("Shift"),e=s||String.fromCharCode(i),r.length||s?(r.push(e),r.join("-")):e}var n={8:"Backspace",9:"Tab",10:"Enter",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Esc",32:"Spacebar",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",45:"Insert",46:"Del",144:"NumLock"};return function(n,i){function s(t){d=t,clearTimeout(l),l=setTimeout(t)}function r(){i.keystroke(t(u),u)}function o(){if(!function(){var t=f[0];return"selectionStart"in t&&t.selectionStart!==t.selectionEnd}()){var t=f.val();1===t.length?(f.val(""),i.typedText(t)):t&&f[0].select&&f[0].select()}}function a(){var t=f.val();f.val(""),t&&i.paste(t)}var l,c,u=null,h=null,f=pt(n),p=pt(i.container||f),d=e;return p.bind("keydown keypress input keyup focusout paste",function(t){d(t)}),c=!1,p.bind({keydown:function(t){u=t,h=null,c&&s(function(t){t&&"focusout"===t.type||!f[0].select||f[0].select(),d=e,clearTimeout(l)}),r()},keypress:function(t){u&&h&&r(),h=t,s(o)},focusout:function(){u=h=null},paste:function(t){f.focus(),s(a)}}),{select:function(t){d(),d=e,clearTimeout(l),f.val(t),t&&f[0].select&&f[0].select(),c=!!t}}}}(),St.open(function(t,e){t.exportText=function(){return this.root.foldChildren("",function(t,e){return t+e.text()})}}),St.open(function(t){t.focusBlurEvents=function(){function t(){clearTimeout(n),r.selection&&r.selection.jQ.addClass("mq-blur"),e()}function e(){r.hide().parent.blur(),i.container.removeClass("mq-focused"),Ot(window).off("blur",t)}var n,i=this,s=i.root,r=i.cursor;i.textarea.focus(function(){i.blurred=!1,clearTimeout(n),i.container.addClass("mq-focused"),r.parent||r.insAtRightEnd(s),r.selection?(r.selection.jQ.removeClass("mq-blur"),i.selectionChanged()):r.show()}).blur(function(){i.blurred=!0,n=setTimeout(function(){s.postOrder("intentionalBlur"),r.clearSelection().endSelection(),e()}),Ot(window).on("blur",t)}),i.blurred=!0,r.hide().parent.blur()}}),St.open(function(t){t.keystroke=function(t,e){this.cursor.parent.keystroke(t,e,this)}}),jt.open(function(t){t.keystroke=function(t,e,n){var i=n.cursor;switch(t){case"Ctrl-Shift-Backspace":case"Ctrl-Backspace":n.ctrlDeleteDir(xt);break;case"Shift-Backspace":case"Backspace":n.backspace();break;case"Esc":case"Tab":return void n.escapeDir(yt,t,e);case"Shift-Tab":case"Shift-Esc":return void n.escapeDir(xt,t,e);case"End":n.notify("move").cursor.insAtRightEnd(i.parent);break;case"Ctrl-End":n.notify("move").cursor.insAtRightEnd(n.root);break;case"Shift-End":for(;i[yt];)n.selectRight();break;case"Ctrl-Shift-End":for(;i[yt]||i.parent!==n.root;)n.selectRight();break;case"Home":n.notify("move").cursor.insAtLeftEnd(i.parent);break;case"Ctrl-Home":n.notify("move").cursor.insAtLeftEnd(n.root);break;case"Shift-Home":for(;i[xt];)n.selectLeft();break;case"Ctrl-Shift-Home":for(;i[xt]||i.parent!==n.root;)n.selectLeft();break;case"Left":n.moveLeft();break;case"Shift-Left":n.selectLeft();break;case"Ctrl-Left":break;case"Right":n.moveRight();break;case"Shift-Right":n.selectRight();break;case"Ctrl-Right":break;case"Up":n.moveUp();break;case"Down":n.moveDown();break;case"Shift-Up":if(i[xt])for(;i[xt];)n.selectLeft();else n.selectLeft();case"Shift-Down":if(i[yt])for(;i[yt];)n.selectRight();else n.selectRight();case"Ctrl-Up":case"Ctrl-Down":break;case"Ctrl-Shift-Del":case"Ctrl-Del":n.ctrlDeleteDir(yt);break;case"Shift-Del":case"Del":n.deleteForward();break;case"Meta-A":case"Ctrl-A":for(n.notify("move").cursor.insAtRightEnd(n.root);i[xt];)n.selectLeft();break;default:return}e.preventDefault(),n.scrollHoriz()},t.moveOutOf=t.moveTowards=t.deleteOutOf=t.deleteTowards=t.unselectInto=t.selectOutOf=t.selectTowards=function(){r("overridden or never called on this node")}}),St.open(function(t){function e(t,e){var n=t.notify("upDown").cursor,i=e+"Into",s=e+"OutOf";return n[yt][i]?n.insAtLeftEnd(n[yt][i]):n[xt][i]?n.insAtRightEnd(n[xt][i]):n.parent.bubble(function(t){var e=t[s];return(!e||("function"==typeof e&&(e=t[s](n)),e instanceof jt&&n.jumpUpDown(t,e),!0===e))&&void 0}),t}this.onNotify(function(t){("move"===t||"upDown"===t)&&this.show().clearSelection()}),t.escapeDir=function(t,e,n){o(t);var i=this.cursor;return i.parent!==this.root&&n.preventDefault(),i.parent!==this.root?(i.parent.moveOutOf(t,i),this.notify("move")):void 0},At.leftRightIntoCmdGoes=function(t){if(t&&"up"!==t&&"down"!==t)throw'"up" or "down" required for leftRightIntoCmdGoes option, got "'+t+'"';return t},t.moveDir=function(t){o(t);var e=this.cursor,n=e.options.leftRightIntoCmdGoes;return e.selection?e.insDirOf(t,e.selection.ends[t]):e[t]?e[t].moveTowards(t,e,n):e.parent.moveOutOf(t,e,n),this.notify("move")},t.moveLeft=function(){return this.moveDir(xt)},t.moveRight=function(){return this.moveDir(yt)},t.moveUp=function(){return e(this,"up")},t.moveDown=function(){return e(this,"down")},this.onNotify(function(t){"upDown"!==t&&(this.upDownCache={})}),this.onNotify(function(t){"edit"===t&&this.show().deleteSelection()}),t.deleteDir=function(t){var e,n;return o(t),n=(e=this.cursor).selection,this.notify("edit"),n||(e[t]?e[t].deleteTowards(t,e):e.parent.deleteOutOf(t,e)),e[xt].siblingDeleted&&e[xt].siblingDeleted(e.options,yt),e[yt].siblingDeleted&&e[yt].siblingDeleted(e.options,xt),e.parent.bubble("reflow"),this},t.ctrlDeleteDir=function(t){o(t);var e=this.cursor;return!e[xt]||e.selection?ctrlr.deleteDir():(this.notify("edit"),Qt(e.parent.ends[xt],e[xt]).remove(),e.insAtDirEnd(xt,e.parent),e[xt].siblingDeleted&&e[xt].siblingDeleted(e.options,yt),e[yt].siblingDeleted&&e[yt].siblingDeleted(e.options,xt),e.parent.bubble("reflow"),this)},t.backspace=function(){return this.deleteDir(xt)},t.deleteForward=function(){return this.deleteDir(yt)},this.onNotify(function(t){"select"!==t&&this.endSelection()}),t.selectDir=function(t){var e,n=this.notify("select").cursor,i=n.selection;o(t),n.anticursor||n.startSelection(),(e=n[t])?i&&i.ends[t]===e&&n.anticursor[-t]!==e?e.unselectInto(t,n):e.selectTowards(t,n):n.parent.selectOutOf(t,n),n.clearSelection(),n.select()||n.show()},t.selectLeft=function(){return this.selectDir(xt)},t.selectRight=function(){return this.selectDir(yt)}}),y=function(){function t(t){var e,n=t[0]||C();for(e=1;e<t.length;e+=1)t[e].children().adopt(n,n.ends[yt],0);return n}var e=q.string,n=q.regex,i=q.letter,s=q.any,r=q.optWhitespace,o=q.succeed,a=q.fail,l=i.map(function(t){return I(t)}),c=n(/^[^${}\\_^]/).map(function(t){return Q(t)}),u=n(/^[^\\a-eg-zA-Z]/).or(e("\\").then(n(/^[a-z]+/i).or(n(/^\s+/).result(" ")).or(s))).then(function(t){var e=Tt[t];return e?e(t).parser():a("unknown command: \\"+t)}).or(l).or(c),h=e("{").then(function(){return p}).skip(e("}")),f=r.then(h.or(u.map(function(t){var e=C();return t.adopt(e,0,0),e}))),p=f.many().map(t).skip(r),d=e("[").then(f.then(function(t){return"]"!==t.join("latex")?o(t):a()}).many().map(t).skip(r)).skip(e("]")),m=p;return m.block=f,m.optBlock=d,m}(),St.open(function(t,e){t.exportLatex=function(){return this.root.latex().replace(/(\\[a-z]+) (?![a-z])/gi,"$1")},t.writeLatex=function(t){var e=this.notify("edit").cursor,n=q.all,i=q.eof,s=y.skip(i).or(n.result(!1)).parse(t);return s&&!s.isEmpty()&&(s.children().adopt(e.parent,e[xt],e[yt]),s.jQize().insertBefore(e.jQ),e[xt]=s.ends[yt],s.finalizeInsert(e.options,e),s.ends[yt][yt].siblingCreated&&s.ends[yt][yt].siblingCreated(e.options,xt),s.ends[xt][xt].siblingCreated&&s.ends[xt][xt].siblingCreated(e.options,yt),e.parent.bubble("reflow")),this},t.renderLatexMath=function(t){var e,n,i=this.root,s=this.cursor,r=q.all,o=q.eof,a=y.skip(o).or(r.result(!1)).parse(t);i.eachChild("postOrder","dispose"),i.ends[xt]=i.ends[yt]=0,a&&a.children().adopt(i,0,0),e=i.jQ,a?(n=a.join("html"),e.html(n),i.jQize(e.children()),i.finalizeInsert(s.options)):e.empty(),delete s.selection,s.insAtRightEnd(i)},t.renderLatexText=function(t){var e,n,i,s,r,o,a,l,c=this.root,u=this.cursor;if(c.jQ.children().slice(1).remove(),c.eachChild("postOrder","dispose"),c.ends[xt]=c.ends[yt]=0,delete u.selection,u.show().insAtRightEnd(c),e=q.regex,n=q.string,i=q.eof,s=q.all,r=n("$").then(y).skip(n("$").or(i)).map(function(t){var e,n=L(u);return n.createBlocks(),e=n.ends[xt],t.children().adopt(e,0,0),n}),o=n("\\$").result("$").or(e(/^[^$]/)).map(Q),a=r.or(o).many().skip(i).or(s.result(!1)).parse(t)){for(l=0;l<a.length;l+=1)a[l].adopt(c,c.ends[yt],0);c.jQize().appendTo(c.jQ),c.finalizeInsert(u.options)}}}),St.open(function(t){t.delegateMouseEvents=function(){var t=this.root.jQ;this.container.bind("mousedown.mathquill",function(n){function i(t){r=Ot(t.target)}function s(t){l.anticursor||l.startSelection(),a.seek(r,t.pageX,t.pageY).cursor.select(),r=g}var r,o=Ot(n.target).closest(".mq-root-block"),a=jt.byId[o.attr(mt)||t.attr(mt)].controller,l=a.cursor,c=l.blink,u=a.textareaSpan,h=a.textarea;a.blurred&&(a.editable||o.prepend(u),h.focus()),n.preventDefault(),n.target.unselectable=!0,l.blink=e,a.seek(Ot(n.target),n.pageX,n.pageY).cursor.startSelection(),o.mousemove(i),Ot(n.target.ownerDocument).mousemove(s).mouseup(function t(e){l.blink=c,l.selection||(a.editable?l.show():u.detach()),o.unbind("mousemove",i),Ot(e.target.ownerDocument).unbind("mousemove",s).unbind("mouseup",t)})})}}),St.open(function(t){t.seek=function(t,e,n){var i,s,o,a=this.notify("select").cursor;return t&&((i=t.attr(mt)||t.attr(dt))||(i=(s=t.parent()).attr(mt)||s.attr(dt))),r("nodeId is the id of some Node that exists",o=i?jt.byId[i]:this.root),a.clearSelection().show(),o.seek(e,a),this.scrollHoriz(),this}}),St.open(function(t){t.scrollHoriz=function(){var t,e,n,i,s,r=this.cursor,o=r.selection,a=this.root.jQ[0].getBoundingClientRect();if(o)if(i=(n=o.jQ[0].getBoundingClientRect()).left-(a.left+20),s=n.right-(a.right-20),o.ends[xt]===r[yt])if(0>i)e=i;else{if(!(s>0))return;e=n.left-s<a.left+20?i:s}else if(s>0)e=s;else{if(!(0>i))return;e=n.right-i>a.right-20?s:i}else if((t=r.jQ[0].getBoundingClientRect().left)>a.right-20)e=t-(a.right-20);else{if(!(t<a.left+20))return;e=t-(a.left+20)}this.root.jQ.stop().animate({scrollLeft:"+="+e},100)}}),St.open(function(t){Et.p.substituteTextarea=function(){return Ot("<textarea autocapitalize=off autocomplete=off autocorrect=off spellcheck=false x-palm-disable-ste-all=true />")[0]},t.createTextarea=function(){var t,e=this.textareaSpan=Ot('<span class="mq-textarea"></span>'),n=this.options.substituteTextarea();if(!n.nodeType)throw"substituteTextarea() must return a DOM element, got "+n;n=this.textarea=Ot(n).appendTo(e),(t=this).cursor.selectionChanged=function(){t.selectionChanged()},t.container.bind("copy",function(){t.setTextareaSelection()})},t.selectionChanged=function(){var t=this;X(t.container[0]),t.textareaSelectionTimeout===g&&(t.textareaSelectionTimeout=setTimeout(function(){t.setTextareaSelection()}))},t.setTextareaSelection=function(){this.textareaSelectionTimeout=g;var t="";this.cursor.selection&&(t=this.cursor.selection.join("latex"),this.options.statelessClipboard&&(t="$"+t+"$")),this.selectFn(t)},t.staticMathTextareaEvents=function(){function t(){s.detach(),e.blurred=!0}var e=this,n=(e.root,e.cursor),i=e.textarea,s=e.textareaSpan;this.container.prepend('<span class="mq-selectable">$'+e.exportLatex()+"$</span>"),e.blurred=!0,i.bind("cut paste",!1).focus(function(){e.blurred=!1}).blur(function(){n.selection&&n.selection.clear(),setTimeout(t)}),e.selectFn=function(t){i.val(t),t&&i.select()}},t.editablesTextareaEvents=function(){var t=this,e=(t.root,t.cursor),n=t.textarea,i=t.textareaSpan,s=x(n,this);this.selectFn=function(t){s.select(t)},this.container.prepend(i).on("cut",function(n){e.selection&&setTimeout(function(){t.notify("edit"),e.parent.bubble("reflow")})}),this.focusBlurEvents()},t.typedText=function(t){if("\n"===t)return this.handle("enter");var e=this.notify().cursor;e.parent.write(e,t),this.scrollHoriz()},t.paste=function(t){this.options.statelessClipboard&&(t="$"===t.slice(0,1)&&"$"===t.slice(-1)?t.slice(1,-1):"\\text{"+t+"}"),this.writeLatex(t).cursor.show()}}),O=qt(jt,function(t,e){t.finalizeInsert=function(t,e){var n=this;n.postOrder("finalizeTree",t),n.postOrder("contactWeld",e),n.postOrder("blur"),n.postOrder("reflow"),n[yt].siblingCreated&&n[yt].siblingCreated(t,xt),n[xt].siblingCreated&&n[xt].siblingCreated(t,yt),n.bubble("reflow")}}),k=qt(O,function(t,e){t.init=function(t,n,i){var s=this;e.init.call(s),s.ctrlSeq||(s.ctrlSeq=t),n&&(s.htmlTemplate=n),i&&(s.textTemplate=i)},t.replaces=function(t){t.disown(),this.replacedFragment=t},t.isEmpty=function(){return this.foldChildren(!0,function(t,e){return t&&e.isEmpty()})},t.parser=function(){var t=y.block,e=this;return t.times(e.numBlocks()).map(function(t){e.blocks=t;for(var n=0;n<t.length;n+=1)t[n].adopt(e,e.ends[yt],0);return e})},t.createLeftOf=function(t){var n=this,i=n.replacedFragment;n.createBlocks(),e.createLeftOf.call(n,t),i&&(i.adopt(n.ends[xt],0,0),i.jQ.appendTo(n.ends[xt].jQ)),n.finalizeInsert(t.options),n.placeCursor(t)},t.createBlocks=function(){var t,e=this,n=e.numBlocks(),i=e.blocks=Array(n);for(t=0;n>t;t+=1)(i[t]=C()).adopt(e,e.ends[yt],0)},t.placeCursor=function(t){t.insAtRightEnd(this.foldChildren(this.ends[xt],function(t,e){return t.isEmpty()?t:e}))},t.moveTowards=function(t,e,n){var i=n&&this[n+"Into"];e.insAtDirEnd(-t,i||this.ends[-t])},t.deleteTowards=function(t,e){this.isEmpty()?e[t]=this.remove()[t]:this.moveTowards(t,e,null)},t.selectTowards=function(t,e){e[-t]=this,e[t]=this[t]},t.selectChildren=function(){return _t(this,this)},t.unselectInto=function(t,e){e.insAtDirEnd(-t,e.anticursor.ancestors[this.id])},t.seek=function(t,e){function n(t){var e={};return e[xt]=t.jQ.offset().left,e[yt]=e[xt]+t.jQ.outerWidth(),e}var i,s=this,r=n(s);return t<r[xt]?e.insLeftOf(s):t>r[yt]?e.insRightOf(s):(i=r[xt],void s.eachChild(function(o){var a=n(o);return t<a[xt]?(t-i<a[xt]-t?o[xt]?e.insAtRightEnd(o[xt]):e.insLeftOf(s):e.insAtLeftEnd(o),!1):t>a[yt]?void(o[yt]?i=a[yt]:r[yt]-t<t-a[yt]?e.insRightOf(s):e.insAtRightEnd(o)):(o.seek(t,e),!1)}))},t.numBlocks=function(){var t=this.htmlTemplate.match(/&\d+/g);return t?t.length:0},t.html=function(){var t,e,n,i=this,s=i.blocks,o=" mathquill-command-id="+i.id,a=i.htmlTemplate.match(/<[^<>]+>|[^<>]+/g);for(r("no unmatched angle brackets",a.join("")===this.htmlTemplate),t=0,e=a[0];e;e=a[t+=1])if("/>"===e.slice(-2))a[t]=e.slice(0,-2)+o+"/>";else if("<"===e.charAt(0)){r("not an unmatched top-level close tag","/"!==e.charAt(1)),a[t]=e.slice(0,-1)+o+">",n=1;do{r("no missing close tags",e=a[t+=1]),"</"===e.slice(0,2)?n-=1:"<"===e.charAt(0)&&"/>"!==e.slice(-2)&&(n+=1)}while(n>0)}return a.join("").replace(/>&(\d+)/g,function(t,e){return" mathquill-block-id="+s[e].id+">"+s[e].join("html")})},t.latex=function(){return this.foldChildren(this.ctrlSeq,function(t,e){return t+"{"+(e.latex()||" ")+"}"})},t.textTemplate=[""],t.text=function(){var t=this,e=0;return t.foldChildren(t.textTemplate[e],function(n,i){e+=1;var s=i.text();return n&&"("===t.textTemplate[e]&&"("===s[0]&&")"===s.slice(-1)?n+s.slice(1,-1)+t.textTemplate[e]:n+i.text()+(t.textTemplate[e]||"")})}}),j=qt(k,function(t,n){t.init=function(t,e,i){i||(i=t&&t.length>1?t.slice(1):t),n.init.call(this,t,e,[i])},t.parser=function(){return q.succeed(this)},t.numBlocks=function(){return 0},t.replaces=function(t){t.remove()},t.createBlocks=e,t.moveTowards=function(t,e){e.jQ.insDirOf(t,this.jQ),e[-t]=this,e[t]=this[t]},t.deleteTowards=function(t,e){e[t]=this.remove()[t]},t.seek=function(t,e){t-this.jQ.offset().left<this.jQ.outerWidth()/2?e.insLeftOf(this):e.insRightOf(this)},t.latex=function(){return this.ctrlSeq},t.text=function(){return this.textTemplate},t.placeCursor=e,t.isEmpty=function(){return!0}}),Q=qt(j,function(t,e){t.init=function(t,n){e.init.call(this,t,"<span>"+(n||t)+"</span>")}}),T=qt(j,function(t,e){t.init=function(t,n,i){e.init.call(this,t,'<span class="mq-binary-operator">'+n+"</span>",i)}}),C=qt(O,function(t,e){t.join=function(t){return this.foldChildren("",function(e,n){return e+n[t]()})},t.html=function(){return this.join("html")},t.latex=function(){return this.join("latex")},t.text=function(){return this.ends[xt]===this.ends[yt]&&0!==this.ends[xt]?this.ends[xt].text():this.join("text")},t.keystroke=function(t,n,i){return!i.options.spaceBehavesLikeTab||"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):(n.preventDefault(),void i.escapeDir("Shift-Spacebar"===t?xt:yt,t,n))},t.moveOutOf=function(t,e,n){!(n&&this.parent[n+"Into"])&&this[t]?e.insAtDirEnd(-t,this[t]):e.insDirOf(t,this.parent)},t.selectOutOf=function(t,e){e.insDirOf(t,this.parent)},t.deleteOutOf=function(t,e){e.unwrapGramp()},t.seek=function(t,e){var n=this.ends[yt];if(!n||n.jQ.offset().left+n.jQ.outerWidth()<t)return e.insAtRightEnd(this);if(t<this.ends[xt].jQ.offset().left)return e.insAtLeftEnd(this);for(;t<n.jQ.offset().left;)n=n[xt];return n.seek(t,e)},t.chToCmd=function(t){var e;return t.match(/^[a-eg-zA-Z]$/)?I(t):/^\d$/.test(t)?A(t):(e=Ct[t]||Tt[t])?e(t):Q(t)},t.write=function(t,e){var n=this.chToCmd(e);t.selection&&n.replaces(t.replaceSelection()),n.createLeftOf(t.show())},t.focus=function(){return this.jQ.addClass("mq-hasCursor"),this.jQ.removeClass("mq-empty"),this},t.blur=function(){return this.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.jQ.addClass("mq-empty"),this}}),Lt.StaticMath=function(t){return qt(t.AbstractMathQuill,function(e,n){this.RootBlock=C,e.__mathquillify=function(){return n.__mathquillify.call(this,"mq-math-mode"),this.__controller.delegateMouseEvents(),this.__controller.staticMathTextareaEvents(),this},e.init=function(){n.init.apply(this,arguments),this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField)},e.latex=function(){var e=n.latex.apply(this,arguments);return arguments.length>0&&this.__controller.root.postOrder("registerInnerField",this.innerFields=[],t.MathField),e}})},D=qt(C,h),Lt.MathField=function(t){return qt(t.EditableField,function(t,n){this.RootBlock=D,t.__mathquillify=function(t,i){return this.config(t),i>1&&(this.__controller.root.reflow=e),n.__mathquillify.call(this,"mq-editable-field mq-math-mode"),delete this.__controller.root.reflow,this}})},_=qt(jt,function(t,e){function n(t){var e,n;return t.jQ[0].normalize(),r("only node in TextBlock span is Text node",3===(e=t.jQ[0].firstChild).nodeType),(n=S(e.data)).jQadd(e),t.children().disown(),n.adopt(t,0,0)}t.ctrlSeq="\\text",t.replaces=function(t){t instanceof Qt?this.replacedText=t.remove().jQ.text():"string"==typeof t&&(this.replacedText=t)},t.jQadd=function(t){e.jQadd.call(this,t),this.ends[xt]&&this.ends[xt].jQadd(this.jQ[0].firstChild)},t.createLeftOf=function(t){var n,i=this;if(e.createLeftOf.call(this,t),i[yt].siblingCreated&&i[yt].siblingCreated(t.options,xt),i[xt].siblingCreated&&i[xt].siblingCreated(t.options,yt),i.bubble("reflow"),t.insAtRightEnd(i),i.replacedText)for(n=0;n<i.replacedText.length;n+=1)i.write(t,i.replacedText.charAt(n))},t.parser=function(){var t=this,e=q.string,n=q.regex;return q.optWhitespace.then(e("{")).then(n(/^[^}]*/)).skip(e("}")).map(function(e){return S(e).adopt(t,0,0),t})},t.textContents=function(){return this.foldChildren("",function(t,e){return t+e.text})},t.text=function(){return'"'+this.textContents()+'"'},t.latex=function(){return"\\text{"+this.textContents()+"}"},t.html=function(){return'<span class="mq-text-mode" mathquill-command-id='+this.id+">"+this.textContents()+"</span>"},t.moveTowards=function(t,e){e.insAtDirEnd(-t,this)},t.moveOutOf=function(t,e){e.insDirOf(t,this)},t.unselectInto=t.moveTowards,t.selectTowards=k.prototype.selectTowards,t.deleteTowards=k.prototype.deleteTowards,t.selectOutOf=function(t,e){e.insDirOf(t,this)},t.deleteOutOf=function(t,e){this.isEmpty()&&e.insRightOf(this)},t.write=function(t,n){var i,s;t.show().deleteSelection(),"$"!==n?t[xt]?t[xt].appendText(n):S(n).createLeftOf(t):this.isEmpty()?(t.insRightOf(this),Q("\\$","$").createLeftOf(t)):t[yt]?t[xt]?(i=_(),(s=this.ends[xt]).disown(),s.adopt(i,0,0),t.insLeftOf(this),e.createLeftOf.call(i,t)):t.insLeftOf(this):t.insRightOf(this)},t.seek=function(t,e){var i,s,r,o,a,l,c,u;for(e.hide(),i=n(this),s=this.jQ.width()/this.text.length,0>=(r=Math.round((t-this.jQ.offset().left)/s))?e.insAtLeftEnd(this):r>=i.text.length?e.insAtRightEnd(this):e.insLeftOf(i.splitRight(r)),l=a=(o=t-e.show().offset().left)&&0>o?xt:yt;e[a]&&o*l>0;)e[a].moveTowards(a,e),l=o,o=t-e.offset().left;-a*l>a*o&&e[-a].moveTowards(-a,e),e.anticursor?e.anticursor.parent===this&&(c=e[xt]&&e[xt].text.length,this.anticursorPosition===c?e.anticursor=kt.copy(e):(this.anticursorPosition<c?(u=e[xt].splitRight(this.anticursorPosition),e[xt]=u):u=e[yt].splitRight(this.anticursorPosition-c),e.anticursor=kt(this,u[xt],u))):this.anticursorPosition=e[xt]&&e[xt].text.length},t.blur=function(){C.prototype.blur.call(this),n(this)},t.focus=C.prototype.focus}),S=qt(jt,function(t,e){function n(t,e){return e.charAt(t===xt?0:-1+e.length)}t.init=function(t){e.init.call(this),this.text=t},t.jQadd=function(t){this.dom=t,this.jQ=Ot(t)},t.jQize=function(){return this.jQadd(document.createTextNode(this.text))},t.appendText=function(t){this.text+=t,this.dom.appendData(t)},t.prependText=function(t){this.text=t+this.text,this.dom.insertData(0,t)},t.insTextAtDirEnd=function(t,e){o(e),e===yt?this.appendText(t):this.prependText(t)},t.splitRight=function(t){var e=S(this.text.slice(t)).adopt(this.parent,this,this[yt]);return e.jQadd(this.dom.splitText(t)),this.text=this.text.slice(0,t),e},t.moveTowards=function(t,e){var i,s;return o(t),i=n(-t,this.text),(s=this[-t])?s.insTextAtDirEnd(i,t):S(i).createDir(-t,e),this.deleteTowards(t,e)},t.latex=function(){return this.text},t.deleteTowards=function(t,e){this.text.length>1?t===yt?(this.dom.deleteData(0,1),this.text=this.text.slice(1)):(this.dom.deleteData(-1+this.text.length,1),this.text=this.text.slice(0,-1)):(this.remove(),this.jQ.remove(),e[t]=this[t])},t.selectTowards=function(t,e){var i,s,r,a;return o(t),i=e.anticursor,s=n(-t,this.text),i[t]===this?(r=S(s).createDir(t,e),i[t]=r,e.insDirOf(t,r)):((a=this[-t])?a.insTextAtDirEnd(s,t):(r=S(s).createDir(-t,e)).jQ.insDirOf(-t,e.selection.jQ),1===this.text.length&&i[-t]===this&&(i[-t]=this[-t])),this.deleteTowards(t,e)}}),Ct.$=Tt.text=Tt.textnormal=Tt.textrm=Tt.textup=Tt.textmd=_,Tt.em=Tt.italic=Tt.italics=Tt.emph=Tt.textit=Tt.textsl=f("\\textit","i",'class="mq-text-mode"'),Tt.strong=Tt.bold=Tt.textbf=f("\\textbf","b",'class="mq-text-mode"'),Tt.sf=Tt.textsf=f("\\textsf","span",'class="mq-sans-serif mq-text-mode"'),Tt.tt=Tt.texttt=f("\\texttt","span",'class="mq-monospace mq-text-mode"'),Tt.textsc=f("\\textsc","span",'style="font-variant:small-caps" class="mq-text-mode"'),Tt.uppercase=f("\\uppercase","span",'style="text-transform:uppercase" class="mq-text-mode"'),Tt.lowercase=f("\\lowercase","span",'style="text-transform:lowercase" class="mq-text-mode"'),L=qt(k,function(t,e){t.init=function(t){e.init.call(this,"$"),this.cursor=t},t.htmlTemplate='<span class="mq-math-mode">&0</span>',t.createBlocks=function(){e.createBlocks.call(this),this.ends[xt].cursor=this.cursor,this.ends[xt].write=function(t,e){"$"!==e?C.prototype.write.call(this,t,e):this.isEmpty()?(t.insRightOf(this.parent),this.parent.deleteTowards(dir,t),Q("\\$","$").createLeftOf(t.show())):t[yt]?t[xt]?C.prototype.write.call(this,t,e):t.insLeftOf(this.parent):t.insRightOf(this.parent)}},t.latex=function(){return"$"+this.ends[xt].latex()+"$"}}),E=qt(D,function(t,e){t.keystroke=function(t){return"Spacebar"!==t&&"Shift-Spacebar"!==t?e.keystroke.apply(this,arguments):void 0},t.write=function(t,e){var n;(t.show().deleteSelection(),"$"===e)?L(t).createLeftOf(t):("<"===e?n="&lt;":">"===e&&(n="&gt;"),Q(e,n).createLeftOf(t))}}),Lt.TextField=function(t){return qt(t.EditableField,function(t,e){this.RootBlock=E,t.__mathquillify=function(){return e.__mathquillify.call(this,"mq-editable-field mq-text-mode")},t.latex=function(t){return arguments.length>0?(this.__controller.renderLatexText(t),this.__controller.blurred&&this.__controller.cursor.hide().parent.blur(),this):this.__controller.exportLatex()}})},Ct["\\"]=qt(k,function(t,e){t.ctrlSeq="\\",t.replaces=function(t){this._replacedFragment=t.disown(),this.isEmpty=function(){return!1}},t.htmlTemplate='<span class="mq-latex-command-input mq-non-leaf">\\<span>&0</span></span>',t.textTemplate=["\\"],t.createBlocks=function(){e.createBlocks.call(this),this.ends[xt].focus=function(){return this.parent.jQ.addClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.removeClass("mq-empty"),this},this.ends[xt].blur=function(){return this.parent.jQ.removeClass("mq-hasCursor"),this.isEmpty()&&this.parent.jQ.addClass("mq-empty"),this},this.ends[xt].write=function(t,e){t.show().deleteSelection(),e.match(/[a-z]/i)?Q(e).createLeftOf(t):(this.parent.renderCommand(t),"\\"===e&&this.isEmpty()||this.parent.parent.write(t,e))},this.ends[xt].keystroke=function(t,n,i){return"Tab"===t||"Enter"===t||"Spacebar"===t?(this.parent.renderCommand(i.cursor),void n.preventDefault()):e.keystroke.apply(this,arguments)}},t.createLeftOf=function(t){if(e.createLeftOf.call(this,t),this._replacedFragment){var n=this.jQ[0];this.jQ=this._replacedFragment.jQ.addClass("mq-blur").bind("mousedown mousemove",function(t){return Ot(t.target=n).trigger(t),!1}).insertBefore(this.jQ).add(this.jQ)}},t.latex=function(){return"\\"+this.ends[xt].latex()+" "},t.renderCommand=function(t){var e,n;this.jQ=this.jQ.last(),this.remove(),this[yt]?t.insLeftOf(this[yt]):t.insAtRightEnd(this.parent),(e=this.ends[xt].latex())||(e=" "),(n=Tt[e])?(n=n(e),this._replacedFragment&&n.replaces(this._replacedFragment),n.createLeftOf(t)):((n=_()).replaces(e),n.createLeftOf(t),t.insRightOf(n),this._replacedFragment&&this._replacedFragment.remove())}}),Tt.notin=Tt.cong=Tt.equiv=Tt.oplus=Tt.otimes=qt(T,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),Tt["≠"]=Tt.ne=Tt.neq=s(T,"\\ne ","&ne;"),Tt.ast=Tt.star=Tt.loast=Tt.lowast=s(T,"\\ast ","&lowast;"),Tt.therefor=Tt.therefore=s(T,"\\therefore ","&there4;"),Tt.cuz=Tt.because=s(T,"\\because ","&#8757;"),Tt.prop=Tt.propto=s(T,"\\propto ","&prop;"),Tt["≈"]=Tt.asymp=Tt.approx=s(T,"\\approx ","&asymp;"),Tt.isin=Tt.in=s(T,"\\in ","&isin;"),Tt.ni=Tt.contains=s(T,"\\ni ","&ni;"),Tt.notni=Tt.niton=Tt.notcontains=Tt.doesnotcontain=s(T,"\\not\\ni ","&#8716;"),Tt.sub=Tt.subset=s(T,"\\subset ","&sub;"),Tt.sup=Tt.supset=Tt.superset=s(T,"\\supset ","&sup;"),Tt.nsub=Tt.notsub=Tt.nsubset=Tt.notsubset=s(T,"\\not\\subset ","&#8836;"),Tt.nsup=Tt.notsup=Tt.nsupset=Tt.notsupset=Tt.nsuperset=Tt.notsuperset=s(T,"\\not\\supset ","&#8837;"),Tt.sube=Tt.subeq=Tt.subsete=Tt.subseteq=s(T,"\\subseteq ","&sube;"),Tt.supe=Tt.supeq=Tt.supsete=Tt.supseteq=Tt.supersete=Tt.superseteq=s(T,"\\supseteq ","&supe;"),Tt.nsube=Tt.nsubeq=Tt.notsube=Tt.notsubeq=Tt.nsubsete=Tt.nsubseteq=Tt.notsubsete=Tt.notsubseteq=s(T,"\\not\\subseteq ","&#8840;"),Tt.nsupe=Tt.nsupeq=Tt.notsupe=Tt.notsupeq=Tt.nsupsete=Tt.nsupseteq=Tt.notsupsete=Tt.notsupseteq=Tt.nsupersete=Tt.nsuperseteq=Tt.notsupersete=Tt.notsuperseteq=s(T,"\\not\\supseteq ","&#8841;"),Tt.N=Tt.naturals=Tt.Naturals=s(Q,"\\mathbb{N}","&#8469;"),Tt.P=Tt.primes=Tt.Primes=Tt.projective=Tt.Projective=Tt.probability=Tt.Probability=s(Q,"\\mathbb{P}","&#8473;"),Tt.Z=Tt.integers=Tt.Integers=s(Q,"\\mathbb{Z}","&#8484;"),Tt.Q=Tt.rationals=Tt.Rationals=s(Q,"\\mathbb{Q}","&#8474;"),Tt.R=Tt.reals=Tt.Reals=s(Q,"\\mathbb{R}","&#8477;"),Tt.C=Tt.complex=Tt.Complex=Tt.complexes=Tt.Complexes=Tt.complexplane=Tt.Complexplane=Tt.ComplexPlane=s(Q,"\\mathbb{C}","&#8450;"),Tt.H=Tt.Hamiltonian=Tt.quaternions=Tt.Quaternions=s(Q,"\\mathbb{H}","&#8461;"),Tt.quad=Tt.emsp=s(Q,"\\quad ","    "),Tt.qquad=s(Q,"\\qquad ","        "),Tt.diamond=s(Q,"\\diamond ","&#9671;"),Tt.bigtriangleup=s(Q,"\\bigtriangleup ","&#9651;"),Tt.ominus=s(Q,"\\ominus ","&#8854;"),Tt.uplus=s(Q,"\\uplus ","&#8846;"),Tt.bigtriangledown=s(Q,"\\bigtriangledown ","&#9661;"),Tt.sqcap=s(Q,"\\sqcap ","&#8851;"),Tt.triangleleft=s(Q,"\\triangleleft ","&#8882;"),Tt.sqcup=s(Q,"\\sqcup ","&#8852;"),Tt.triangleright=s(Q,"\\triangleright ","&#8883;"),Tt.odot=Tt.circledot=s(Q,"\\odot ","&#8857;"),Tt.bigcirc=s(Q,"\\bigcirc ","&#9711;"),Tt.dagger=s(Q,"\\dagger ","&#0134;"),Tt.ddagger=s(Q,"\\ddagger ","&#135;"),Tt.wr=s(Q,"\\wr ","&#8768;"),Tt.amalg=s(Q,"\\amalg ","&#8720;"),Tt.models=s(Q,"\\models ","&#8872;"),Tt.prec=s(Q,"\\prec ","&#8826;"),Tt.succ=s(Q,"\\succ ","&#8827;"),Tt.preceq=s(Q,"\\preceq ","&#8828;"),Tt.succeq=s(Q,"\\succeq ","&#8829;"),Tt.simeq=s(Q,"\\simeq ","&#8771;"),Tt.mid=s(Q,"\\mid ","&#8739;"),Tt.ll=s(Q,"\\ll ","&#8810;"),Tt.gg=s(Q,"\\gg ","&#8811;"),Tt.parallel=s(Q,"\\parallel ","&#8741;"),Tt.nparallel=s(Q,"\\nparallel ","&#8742;"),Tt.bowtie=s(Q,"\\bowtie ","&#8904;"),Tt.sqsubset=s(Q,"\\sqsubset ","&#8847;"),Tt.sqsupset=s(Q,"\\sqsupset ","&#8848;"),Tt.smile=s(Q,"\\smile ","&#8995;"),Tt.sqsubseteq=s(Q,"\\sqsubseteq ","&#8849;"),Tt.sqsupseteq=s(Q,"\\sqsupseteq ","&#8850;"),Tt.doteq=s(Q,"\\doteq ","&#8784;"),Tt.frown=s(Q,"\\frown ","&#8994;"),Tt.vdash=s(Q,"\\vdash ","&#8870;"),Tt.dashv=s(Q,"\\dashv ","&#8867;"),Tt.nless=s(Q,"\\nless ","&#8814;"),Tt.ngtr=s(Q,"\\ngtr ","&#8815;"),Tt.longleftarrow=s(Q,"\\longleftarrow ","&#8592;"),Tt.longrightarrow=s(Q,"\\longrightarrow ","&#8594;"),Tt.Longleftarrow=s(Q,"\\Longleftarrow ","&#8656;"),Tt.Longrightarrow=s(Q,"\\Longrightarrow ","&#8658;"),Tt.longleftrightarrow=s(Q,"\\longleftrightarrow ","&#8596;"),Tt.updownarrow=s(Q,"\\updownarrow ","&#8597;"),Tt.Longleftrightarrow=s(Q,"\\Longleftrightarrow ","&#8660;"),Tt.Updownarrow=s(Q,"\\Updownarrow ","&#8661;"),Tt.mapsto=s(Q,"\\mapsto ","&#8614;"),Tt.nearrow=s(Q,"\\nearrow ","&#8599;"),Tt.hookleftarrow=s(Q,"\\hookleftarrow ","&#8617;"),Tt.hookrightarrow=s(Q,"\\hookrightarrow ","&#8618;"),Tt.searrow=s(Q,"\\searrow ","&#8600;"),Tt.leftharpoonup=s(Q,"\\leftharpoonup ","&#8636;"),Tt.rightharpoonup=s(Q,"\\rightharpoonup ","&#8640;"),Tt.swarrow=s(Q,"\\swarrow ","&#8601;"),Tt.leftharpoondown=s(Q,"\\leftharpoondown ","&#8637;"),Tt.rightharpoondown=s(Q,"\\rightharpoondown ","&#8641;"),Tt.nwarrow=s(Q,"\\nwarrow ","&#8598;"),Tt.ldots=s(Q,"\\ldots ","&#8230;"),Tt.cdots=s(Q,"\\cdots ","&#8943;"),Tt.vdots=s(Q,"\\vdots ","&#8942;"),Tt.ddots=s(Q,"\\ddots ","&#8945;"),Tt.surd=s(Q,"\\surd ","&#8730;"),Tt.triangle=s(Q,"\\triangle ","&#9651;"),Tt.ell=s(Q,"\\ell ","&#8467;"),Tt.top=s(Q,"\\top ","&#8868;"),Tt.flat=s(Q,"\\flat ","&#9837;"),Tt.natural=s(Q,"\\natural ","&#9838;"),Tt.sharp=s(Q,"\\sharp ","&#9839;"),Tt.wp=s(Q,"\\wp ","&#8472;"),Tt.bot=s(Q,"\\bot ","&#8869;"),Tt.clubsuit=s(Q,"\\clubsuit ","&#9827;"),Tt.diamondsuit=s(Q,"\\diamondsuit ","&#9826;"),Tt.heartsuit=s(Q,"\\heartsuit ","&#9825;"),Tt.spadesuit=s(Q,"\\spadesuit ","&#9824;"),Tt.parallelogram=s(Q,"\\parallelogram ","&#9649;"),Tt.square=s(Q,"\\square ","&#11036;"),Tt.oint=s(Q,"\\oint ","&#8750;"),Tt.bigcap=s(Q,"\\bigcap ","&#8745;"),Tt.bigcup=s(Q,"\\bigcup ","&#8746;"),Tt.bigsqcup=s(Q,"\\bigsqcup ","&#8852;"),Tt.bigvee=s(Q,"\\bigvee ","&#8744;"),Tt.bigwedge=s(Q,"\\bigwedge ","&#8743;"),Tt.bigodot=s(Q,"\\bigodot ","&#8857;"),Tt.bigotimes=s(Q,"\\bigotimes ","&#8855;"),Tt.bigoplus=s(Q,"\\bigoplus ","&#8853;"),Tt.biguplus=s(Q,"\\biguplus ","&#8846;"),Tt.lfloor=s(Q,"\\lfloor ","&#8970;"),Tt.rfloor=s(Q,"\\rfloor ","&#8971;"),Tt.lceil=s(Q,"\\lceil ","&#8968;"),Tt.rceil=s(Q,"\\rceil ","&#8969;"),Tt.opencurlybrace=Tt.lbrace=s(Q,"\\lbrace ","{"),Tt.closecurlybrace=Tt.rbrace=s(Q,"\\rbrace ","}"),Tt.lbrack=s(Q,"["),Tt.rbrack=s(Q,"]"),Tt["∫"]=Tt.int=Tt.integral=s(j,"\\int ","<big>&int;</big>"),Tt.slash=s(Q,"/"),Tt.vert=s(Q,"|"),Tt.perp=Tt.perpendicular=s(Q,"\\perp ","&perp;"),Tt.nabla=Tt.del=s(Q,"\\nabla ","&nabla;"),Tt.hbar=s(Q,"\\hbar ","&#8463;"),Tt.AA=Tt.Angstrom=Tt.angstrom=s(Q,"\\text\\AA ","&#8491;"),Tt.ring=Tt.circ=Tt.circle=s(Q,"\\circ ","&#8728;"),Tt.bull=Tt.bullet=s(Q,"\\bullet ","&bull;"),Tt.setminus=Tt.smallsetminus=s(Q,"\\setminus ","&#8726;"),Tt.not=Tt["¬"]=Tt.neg=s(Q,"\\neg ","&not;"),Tt["…"]=Tt.dots=Tt.ellip=Tt.hellip=Tt.ellipsis=Tt.hellipsis=s(Q,"\\dots ","&hellip;"),Tt.converges=Tt.darr=Tt.dnarr=Tt.dnarrow=Tt.downarrow=s(Q,"\\downarrow ","&darr;"),Tt.dArr=Tt.dnArr=Tt.dnArrow=Tt.Downarrow=s(Q,"\\Downarrow ","&dArr;"),Tt.diverges=Tt.uarr=Tt.uparrow=s(Q,"\\uparrow ","&uarr;"),Tt.uArr=Tt.Uparrow=s(Q,"\\Uparrow ","&uArr;"),Tt.to=s(T,"\\to ","&rarr;"),Tt.rarr=Tt.rightarrow=s(Q,"\\rightarrow ","&rarr;"),Tt.implies=s(T,"\\Rightarrow ","&rArr;"),Tt.rArr=Tt.Rightarrow=s(Q,"\\Rightarrow ","&rArr;"),Tt.gets=s(T,"\\gets ","&larr;"),Tt.larr=Tt.leftarrow=s(Q,"\\leftarrow ","&larr;"),Tt.impliedby=s(T,"\\Leftarrow ","&lArr;"),Tt.lArr=Tt.Leftarrow=s(Q,"\\Leftarrow ","&lArr;"),Tt.harr=Tt.lrarr=Tt.leftrightarrow=s(Q,"\\leftrightarrow ","&harr;"),Tt.iff=s(T,"\\Leftrightarrow ","&hArr;"),Tt.hArr=Tt.lrArr=Tt.Leftrightarrow=s(Q,"\\Leftrightarrow ","&hArr;"),Tt.Re=Tt.Real=Tt.real=s(Q,"\\Re ","&real;"),Tt.Im=Tt.imag=Tt.image=Tt.imagin=Tt.imaginary=Tt.Imaginary=s(Q,"\\Im ","&image;"),Tt.part=Tt.partial=s(Q,"\\partial ","&part;"),Tt.infty=Tt.infin=Tt.infinity=s(Q,"\\infty ","&infin;"),Tt.alef=Tt.alefsym=Tt.aleph=Tt.alephsym=s(Q,"\\aleph ","&alefsym;"),Tt.xist=Tt.xists=Tt.exist=Tt.exists=s(Q,"\\exists ","&exist;"),Tt.and=Tt.land=Tt.wedge=s(Q,"\\wedge ","&and;"),Tt.or=Tt.lor=Tt.vee=s(Q,"\\vee ","&or;"),Tt.o=Tt.O=Tt.empty=Tt.emptyset=Tt.oslash=Tt.Oslash=Tt.nothing=Tt.varnothing=s(T,"\\varnothing ","&empty;"),Tt.cup=Tt.union=s(T,"\\cup ","&cup;"),Tt.cap=Tt.intersect=Tt.intersection=s(T,"\\cap ","&cap;"),Tt.deg=Tt.degree=s(Q,"\\degree ","&deg;"),Tt.ang=Tt.angle=s(Q,"\\angle ","&ang;"),Tt.measuredangle=s(Q,"\\measuredangle ","&#8737;"),A=qt(Q,function(t,e){t.createLeftOf=function(t){t.options.autoSubscriptNumerals&&t.parent!==t.parent.parent.sub&&(t[xt]instanceof R&&!1!==t[xt].isItalic||t[xt]instanceof et&&t[xt][xt]instanceof R&&!1!==t[xt][xt].isItalic)?(Tt._().createLeftOf(t),e.createLeftOf.call(this,t),t.insRightOf(t.parent.parent)):e.createLeftOf.call(this,t)}}),R=qt(j,function(t,e){t.init=function(t,n){e.init.call(this,t,"<var>"+(n||t)+"</var>")},t.text=function(){var t=this.ctrlSeq;return!this[xt]||this[xt]instanceof R||this[xt]instanceof T||"\\ "===this[xt].ctrlSeq||(t="*"+t),!this[yt]||this[yt]instanceof T||this[yt]instanceof et||(t+="*"),t}}),Et.p.autoCommands={_maxLength:0},At.autoCommands=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if((r=e[s]).length<2)throw'autocommand "'+r+'" not minimum length of 2';if(Tt[r]===F)throw'"'+r+'" is a built-in operator name';n[r]=1,i=bt(i,r.length)}return n._maxLength=i,n},I=qt(R,function(t,e){function n(t){return t instanceof j&&!(t instanceof T)}t.init=function(t){return e.init.call(this,this.letter=t)},t.createLeftOf=function(t){var n,i,s,r=t.options.autoCommands,o=r._maxLength;if(o>0){for(n=this.letter,i=t[xt],s=1;i instanceof I&&o>s;)n=i.letter+n,i=i[xt],s+=1;for(;n.length;){if(r.hasOwnProperty(n)){for(s=2,i=t[xt];s<n.length;s+=1,i=i[xt]);return Qt(i,t[xt]).remove(),t[xt]=i[xt],Tt[n](n).createLeftOf(t)}n=n.slice(1)}}e.createLeftOf.apply(this,arguments)},t.italicize=function(t){return this.isItalic=t,this.jQ.toggleClass("mq-operator-name",!t),this},t.finalizeTree=t.siblingDeleted=t.siblingCreated=function(t,e){e!==xt&&this[yt]instanceof I||this.autoUnItalicize(t)},t.autoUnItalicize=function(t){var e,i,s,r,o,a,l,c,u,h,f,p=t.autoOperatorNames;if(0!==p._maxLength){for(e=this.letter,i=this[xt];i instanceof I;i=i[xt])e=i.letter+e;for(s=this[yt];s instanceof I;s=s[yt])e+=s.letter;Qt(i[yt]||this.parent.ends[xt],s[xt]||this.parent.ends[yt]).each(function(t){t.italicize(!0).jQ.removeClass("mq-first mq-last"),t.ctrlSeq=t.letter});t:for(r=0,o=i[yt]||this.parent.ends[xt];r<e.length;r+=1,o=o[yt])for(a=gt(p._maxLength,e.length-r);a>0;a-=1)if(l=e.slice(r,r+a),p.hasOwnProperty(l)){for(c=0,u=o;a>c;c+=1,u=u[yt])u.italicize(!1),h=u;f=z.hasOwnProperty(l),o.ctrlSeq=(f?"\\":"\\operatorname{")+o.ctrlSeq,h.ctrlSeq+=f?" ":"}",B.hasOwnProperty(l)&&h[xt][xt][xt].jQ.addClass("mq-last"),n(o[xt])&&o.jQ.addClass("mq-first"),n(h[yt])&&h.jQ.addClass("mq-last"),r+=a-1,o=h;continue t}}}}),z={},M=Et.p.autoOperatorNames={_maxLength:9},B={limsup:1,liminf:1,projlim:1,injlim:1},function(){var t,e,n,i,s="arg deg det dim exp gcd hom inf ker lg lim ln log max min sup limsup liminf injlim projlim Pr".split(" ");for(t=0;t<s.length;t+=1)z[s[t]]=M[s[t]]=1;for(e="sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth".split(" "),t=0;t<e.length;t+=1)z[e[t]]=1;for(n="sin cos tan sec cosec csc cotan cot ctg".split(" "),t=0;t<n.length;t+=1)M[n[t]]=M["arc"+n[t]]=M[n[t]+"h"]=M["ar"+n[t]+"h"]=M["arc"+n[t]+"h"]=1;for(i="gcf hcf lcm proj span".split(" "),t=0;t<i.length;t+=1)M[i[t]]=1}(),At.autoOperatorNames=function(t){var e,n,i,s,r;if(!/^[a-z]+(?: [a-z]+)*$/i.test(t))throw'"'+t+'" not a space-delimited list of only letters';for(e=t.split(" "),n={},i=0,s=0;s<e.length;s+=1){if((r=e[s]).length<2)throw'"'+r+'" not minimum length of 2';n[r]=1,i=bt(i,r.length)}return n._maxLength=i,n},F=qt(j,function(t,e){t.init=function(t){this.ctrlSeq=t},t.createLeftOf=function(t){var e,n=this.ctrlSeq;for(e=0;e<n.length;e+=1)I(n.charAt(e)).createLeftOf(t)},t.parser=function(){var t,e=this.ctrlSeq,n=C();for(t=0;t<e.length;t+=1)I(e.charAt(t)).adopt(n,n.ends[yt],0);return q.succeed(n.children())}}),M)M.hasOwnProperty($)&&(Tt[$]=F);for(J in Tt.operatorname=qt(k,function(t){t.createLeftOf=e,t.numBlocks=function(){return 1},t.parser=function(){return y.block.map(function(t){return t.children()})}}),Tt.f=qt(I,function(t,e){t.init=function(){j.p.init.call(this,this.letter="f",'<var class="mq-f">f</var>')},t.italicize=function(t){return this.jQ.html("f").toggleClass("mq-f",t),e.italicize.apply(this,arguments)}}),Tt[" "]=Tt.space=s(Q,"\\ ","&nbsp;"),Tt["'"]=Tt.prime=s(Q,"'","&prime;"),Tt.backslash=s(Q,"\\backslash ","\\"),Ct["\\"]||(Ct["\\"]=Tt.backslash),Tt.$=s(Q,"\\$","$"),N=qt(j,function(t,e){t.init=function(t,n){e.init.call(this,t,'<span class="mq-nonSymbola">'+(n||t)+"</span>")}}),Tt["@"]=N,Tt["&"]=s(N,"\\&","&amp;"),Tt["%"]=s(N,"\\%","%"),Tt.alpha=Tt.beta=Tt.gamma=Tt.delta=Tt.zeta=Tt.eta=Tt.theta=Tt.iota=Tt.kappa=Tt.mu=Tt.nu=Tt.xi=Tt.rho=Tt.sigma=Tt.tau=Tt.chi=Tt.psi=Tt.omega=qt(R,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),Tt.phi=s(R,"\\phi ","&#981;"),Tt.phiv=Tt.varphi=s(R,"\\varphi ","&phi;"),Tt.epsilon=s(R,"\\epsilon ","&#1013;"),Tt.epsiv=Tt.varepsilon=s(R,"\\varepsilon ","&epsilon;"),Tt.piv=Tt.varpi=s(R,"\\varpi ","&piv;"),Tt.sigmaf=Tt.sigmav=Tt.varsigma=s(R,"\\varsigma ","&sigmaf;"),Tt.thetav=Tt.vartheta=Tt.thetasym=s(R,"\\vartheta ","&thetasym;"),Tt.upsilon=Tt.upsi=s(R,"\\upsilon ","&upsilon;"),Tt.gammad=Tt.Gammad=Tt.digamma=s(R,"\\digamma ","&#989;"),Tt.kappav=Tt.varkappa=s(R,"\\varkappa ","&#1008;"),Tt.rhov=Tt.varrho=s(R,"\\varrho ","&#1009;"),Tt.pi=Tt["π"]=s(N,"\\pi ","&pi;"),Tt.lambda=s(N,"\\lambda ","&lambda;"),Tt.Upsilon=Tt.Upsi=Tt.upsih=Tt.Upsih=s(j,"\\Upsilon ",'<var style="font-family: serif">&upsih;</var>'),Tt.Gamma=Tt.Delta=Tt.Theta=Tt.Lambda=Tt.Xi=Tt.Pi=Tt.Sigma=Tt.Phi=Tt.Psi=Tt.Omega=Tt.forall=qt(Q,function(t,e){t.init=function(t){e.init.call(this,"\\"+t+" ","&"+t+";")}}),P=qt(k,function(t){t.init=function(t){this.latex=t},t.createLeftOf=function(t){var e=y.parse(this.latex);e.children().adopt(t.parent,t[xt],t[yt]),t[xt]=e.ends[yt],e.jQize().insertBefore(t.jQ),e.finalizeInsert(t.options,t),e.ends[yt][yt].siblingCreated&&e.ends[yt][yt].siblingCreated(t.options,xt),e.ends[xt][xt].siblingCreated&&e.ends[xt][xt].siblingCreated(t.options,yt),t.parent.bubble("reflow")},t.parser=function(){var t=y.parse(this.latex).children();return q.succeed(t)}}),Tt["¹"]=s(P,"^1"),Tt["²"]=s(P,"^2"),Tt["³"]=s(P,"^3"),Tt["¼"]=s(P,"\\frac14"),Tt["½"]=s(P,"\\frac12"),Tt["¾"]=s(P,"\\frac34"),U=qt(T,function(t){t.init=Q.prototype.init,t.contactWeld=t.siblingCreated=t.siblingDeleted=function(t,e){return e!==yt?(this.jQ[0].className=!this[xt]||this[xt]instanceof T?"":"mq-binary-operator",this):void 0}}),Tt["+"]=s(U,"+","+"),Tt["–"]=Tt["-"]=s(U,"-","&minus;"),Tt["±"]=Tt.pm=Tt.plusmn=Tt.plusminus=s(U,"\\pm ","&plusmn;"),Tt.mp=Tt.mnplus=Tt.minusplus=s(U,"\\mp ","&#8723;"),Ct["*"]=Tt.sdot=Tt.cdot=s(T,"\\cdot ","&middot;","*"),W=qt(T,function(t,e){t.init=function(t,n){this.data=t,this.strict=n;var i=n?"Strict":"";e.init.call(this,t["ctrlSeq"+i],t["html"+i],t["text"+i])},t.swap=function(t){this.strict=t;var e=t?"Strict":"";this.ctrlSeq=this.data["ctrlSeq"+e],this.jQ.html(this.data["html"+e]),this.textTemplate=[this.data["text"+e]]},t.deleteTowards=function(t,n){return t!==xt||this.strict?void e.deleteTowards.apply(this,arguments):(this.swap(!0),void this.bubble("reflow"))}}),H={ctrlSeq:"\\le ",html:"&le;",text:"≤",ctrlSeqStrict:"<",htmlStrict:"&lt;",textStrict:"<"},G={ctrlSeq:"\\ge ",html:"&ge;",text:"≥",ctrlSeqStrict:">",htmlStrict:"&gt;",textStrict:">"},Tt["<"]=Tt.lt=s(W,H,!0),Tt[">"]=Tt.gt=s(W,G,!0),Tt["≤"]=Tt.le=Tt.leq=s(W,H,!1),Tt["≥"]=Tt.ge=Tt.geq=s(W,G,!1),K=qt(T,function(t,e){t.init=function(){e.init.call(this,"=","=")},t.createLeftOf=function(t){return t[xt]instanceof W&&t[xt].strict?(t[xt].swap(!1),void t[xt].bubble("reflow")):void e.createLeftOf.apply(this,arguments)}}),Tt["="]=K,Tt["×"]=Tt.times=s(T,"\\times ","&times;","[x]"),Tt["÷"]=Tt.div=Tt.divide=Tt.divides=s(T,"\\div ","&divide;","[/]"),Ct["~"]=Tt.sim=s(T,"\\sim ","~","~"),X=e,Z=document.createElement("div").style,{transform:1,WebkitTransform:1,MozTransform:1,OTransform:1,msTransform:1})if(J in Z){V=J;break}for(ft in V?Y=function(t,e,n){t.css(V,"scale("+e+","+n+")")}:"filter"in Z?(X=function(t){t.className=t.className},Y=function(t,e,n){function i(){t.css("marginRight",(s.width()-1)*(e-1)/e+"px")}var s,r;e/=1+(n-1)/2,t.css("fontSize",n+"em"),t.hasClass("mq-matrixed-container")||t.addClass("mq-matrixed-container").wrapInner('<span class="mq-matrixed"></span>'),s=t.children().css("filter","progid:DXImageTransform.Microsoft.Matrix(M11="+e+",SizingMethod='auto expand')"),i(),r=setInterval(i),Ot(window).load(function(){clearTimeout(r),i()})}):Y=function(t,e,n){t.css("fontSize",n+"em")},tt=qt(k,function(t,e){t.init=function(t,n,i){e.init.call(this,t,"<"+n+" "+i+">&0</"+n+">")}}),Tt.mathrm=s(tt,"\\mathrm","span",'class="mq-roman mq-font"'),Tt.mathit=s(tt,"\\mathit","i",'class="mq-font"'),Tt.mathbf=s(tt,"\\mathbf","b",'class="mq-font"'),Tt.mathsf=s(tt,"\\mathsf","span",'class="mq-sans-serif mq-font"'),Tt.mathtt=s(tt,"\\mathtt","span",'class="mq-monospace mq-font"'),Tt.underline=s(tt,"\\underline","span",'class="mq-non-leaf mq-underline"'),Tt.overline=Tt.bar=s(tt,"\\overline","span",'class="mq-non-leaf mq-overline"'),Tt.overrightarrow=s(tt,"\\overrightarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-right"'),Tt.overleftarrow=s(tt,"\\overleftarrow","span",'class="mq-non-leaf mq-overarrow mq-arrow-left"'),Tt.textcolor=qt(k,function(t,e){t.setColor=function(t){this.color=t,this.htmlTemplate='<span class="mq-textcolor" style="color:'+t+'">&0</span>'},t.latex=function(){return"\\textcolor{"+this.color+"}{"+this.blocks[0].latex()+"}"},t.parser=function(){var t=this,n=q.optWhitespace,i=q.string,s=q.regex;return n.then(i("{")).then(s(/^[#\w\s.,()%-]*/)).skip(i("}")).then(function(n){return t.setColor(n),e.parser.call(t)})}}),Tt.class=qt(k,function(t,e){t.parser=function(){var t=this,n=q.string,i=q.regex;return q.optWhitespace.then(n("{")).then(i(/^[-\w\s\\\xA0-\xFF]*/)).skip(n("}")).then(function(n){return t.htmlTemplate='<span class="mq-class '+n+'">&0</span>',e.parser.call(t)})}}),et=qt(k,function(t,e){t.ctrlSeq="_{...}^{...}",t.createLeftOf=function(t){return t[xt]||!t.options.supSubsRequireOperand?e.createLeftOf.apply(this,arguments):void 0},t.contactWeld=function(t){var e,n,i,s,r,o;for(e=xt;e;e=e===xt&&yt)if(this[e]instanceof et){for(n="sub";n;n="sub"===n&&"sup")i=this[n],s=this[e][n],i&&(s?i.isEmpty()?o=kt(s,0,s.ends[xt]):(i.jQ.children().insAtDirEnd(-e,s.jQ),r=i.children().disown(),o=kt(s,r.ends[yt],s.ends[xt]),e===xt?r.adopt(s,s.ends[yt],0):r.adopt(s,0,s.ends[xt])):this[e].addBlock(i.disown()),this.placeCursor=function(t,n){return function(i){i.insAtDirEnd(-e,t||n)}}(s,i));this.remove(),t&&t[xt]===this&&(e===yt&&o?o[xt]?t.insRightOf(o[xt]):t.insAtLeftEnd(o.parent):t.insRightOf(this[e]));break}this.respace()},Et.p.charsThatBreakOutOfSupSub="",t.finalizeTree=function(){this.ends[xt].write=function(t,e){if(t.options.autoSubscriptNumerals&&this===this.parent.sub){if("_"===e)return;var n=this.chToCmd(e);return n instanceof j?t.deleteSelection():t.clearSelection().insRightOf(this.parent),n.createLeftOf(t.show())}t[xt]&&!t[yt]&&!t.selection&&t.options.charsThatBreakOutOfSupSub.indexOf(e)>-1&&t.insRightOf(this.parent),C.p.write.apply(this,arguments)}},t.moveTowards=function(t,n,i){n.options.autoSubscriptNumerals&&!this.sup?n.insDirOf(t,this):e.moveTowards.apply(this,arguments)},t.deleteTowards=function(t,n){if(n.options.autoSubscriptNumerals&&this.sub){var i=this.sub.ends[-t];i instanceof j?i.remove():i&&i.deleteTowards(t,n.insAtDirEnd(-t,this.sub)),this.sub.isEmpty()&&(this.sub.deleteOutOf(xt,n.insAtLeftEnd(this.sub)),this.sup&&n.insDirOf(-t,this))}else e.deleteTowards.apply(this,arguments)},t.latex=function(){function t(t,e){var n=e&&e.latex();return e?t+(1===n.length?n:"{"+(n||" ")+"}"):""}return t("_",this.sub)+t("^",this.sup)},t.respace=t.siblingCreated=t.siblingDeleted=function(t,e){e!==yt&&this.jQ.toggleClass("mq-limit","\\int "===this[xt].ctrlSeq)},t.addBlock=function(t){"sub"===this.supsub?(this.sup=this.upInto=this.sub.upOutOf=t,t.adopt(this,this.sub,0).downOutOf=this.sub,t.jQ=Ot('<span class="mq-sup"/>').append(t.jQ.children()).attr(mt,t.id).prependTo(this.jQ)):(this.sub=this.downInto=this.sup.downOutOf=t,t.adopt(this,0,this.sup).upOutOf=this.sup,t.jQ=Ot('<span class="mq-sub"></span>').append(t.jQ.children()).attr(mt,t.id).appendTo(this.jQ.removeClass("mq-sup-only")),this.jQ.append('<span style="display:inline-block;width:0">&#8203;</span>'));for(var e=0;2>e;e+=1)!function(t,e,n,i){t[e].deleteOutOf=function(s,r){if(r.insDirOf(this[s]?-s:s,this.parent),!this.isEmpty()){var o=this.ends[s];this.children().disown().withDirAdopt(s,r.parent,r[s],r[-s]).jQ.insDirOf(-s,r.jQ),r[-s]=o}t.supsub=n,delete t[e],delete t[i+"Into"],t[n][i+"OutOf"]=p,delete t[n].deleteOutOf,"sub"===e&&Ot(t.jQ.addClass("mq-sup-only")[0].lastChild).remove(),this.remove()}}(this,"sub sup".split(" ")[e],"sup sub".split(" ")[e],"down up".split(" ")[e])}}),Tt.subscript=Tt._=qt(et,function(t,e){t.supsub="sub",t.htmlTemplate='<span class="mq-supsub mq-non-leaf"><span class="mq-sub">&0</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["_"],t.finalizeTree=function(){this.downInto=this.sub=this.ends[xt],this.sub.upOutOf=p,e.finalizeTree.call(this)}}),Tt.superscript=Tt.supscript=Tt["^"]=qt(et,function(t,e){t.supsub="sup",t.htmlTemplate='<span class="mq-supsub mq-non-leaf mq-sup-only"><span class="mq-sup">&0</span></span>',t.textTemplate=["^"],t.finalizeTree=function(){this.upInto=this.sup=this.ends[yt],this.sup.downOutOf=p,e.finalizeTree.call(this)}}),nt=qt(k,function(t,e){t.init=function(t,e){var n='<span class="mq-large-operator mq-non-leaf"><span class="mq-to"><span>&1</span></span><big>'+e+'</big><span class="mq-from"><span>&0</span></span></span>';j.prototype.init.call(this,t,n)},t.createLeftOf=function(t){e.createLeftOf.apply(this,arguments),t.options.sumStartsWithNEquals&&(I("n").createLeftOf(t),K().createLeftOf(t))},t.latex=function(){function t(t){return 1===t.length?t:"{"+(t||" ")+"}"}return this.ctrlSeq+"_"+t(this.ends[xt].latex())+"^"+t(this.ends[yt].latex())},t.parser=function(){var t,e=q.string,n=q.optWhitespace,i=q.succeed,s=y.block,r=this,o=r.blocks=[C(),C()];for(t=0;t<o.length;t+=1)o[t].adopt(r,r.ends[yt],0);return n.then(e("_").or(e("^"))).then(function(t){var e=o["_"===t?0:1];return s.then(function(t){return t.children().adopt(e,e.ends[yt],0),i(r)})}).many().result(r)},t.finalizeTree=function(){this.downInto=this.ends[xt],this.upInto=this.ends[yt],this.ends[xt].upOutOf=this.ends[yt],this.ends[yt].downOutOf=this.ends[xt]}}),Tt["∑"]=Tt.sum=Tt.summation=s(nt,"\\sum ","&sum;"),Tt["∏"]=Tt.prod=Tt.product=s(nt,"\\prod ","&prod;"),Tt.coprod=Tt.coproduct=s(nt,"\\coprod ","&#8720;"),it=Tt.frac=Tt.dfrac=Tt.cfrac=Tt.fraction=qt(k,function(t,e){t.ctrlSeq="\\frac",t.htmlTemplate='<span class="mq-fraction mq-non-leaf"><span class="mq-numerator">&0</span><span class="mq-denominator">&1</span><span style="display:inline-block;width:0">&#8203;</span></span>',t.textTemplate=["(",")/(",")"],t.finalizeTree=function(){this.upInto=this.ends[yt].upOutOf=this.ends[xt],this.downInto=this.ends[xt].downOutOf=this.ends[yt]}}),st=Tt.over=Ct["/"]=qt(it,function(t,n){t.createLeftOf=function(t){if(!this.replacedFragment){for(var i=t[xt];i&&!(i instanceof T||i instanceof(Tt.text||e)||i instanceof nt||"\\ "===i.ctrlSeq||/^[,;:]$/.test(i.ctrlSeq));)i=i[xt];i instanceof nt&&i[yt]instanceof et&&((i=i[yt])[yt]instanceof et&&i[yt].ctrlSeq!=i.ctrlSeq&&(i=i[yt])),i!==t[xt]&&(this.replaces(Qt(i[yt]||t.parent.ends[xt],t[xt])),t[xt]=i)}n.createLeftOf.call(this,t)}}),rt=Tt.sqrt=Tt["√"]=qt(k,function(t,e){t.ctrlSeq="\\sqrt",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-sqrt-prefix">&radic;</span><span class="mq-non-leaf mq-sqrt-stem">&0</span></span>',t.textTemplate=["sqrt(",")"],t.parser=function(){return y.optBlock.then(function(t){return y.block.map(function(e){var n=ot();return n.blocks=[t,e],t.adopt(n,0,0),e.adopt(n,t,0),n})}).or(e.parser.call(this))},t.reflow=function(){var t=this.ends[yt].jQ;Y(t.prev(),1,t.innerHeight()/+t.css("fontSize").slice(0,-2)-.1)}}),Tt.vec=qt(k,function(t,e){t.ctrlSeq="\\vec",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-vector-prefix">&rarr;</span><span class="mq-vector-stem">&0</span></span>',t.textTemplate=["vec(",")"]}),ot=Tt.nthroot=qt(rt,function(t,e){t.htmlTemplate='<sup class="mq-nthroot mq-non-leaf">&0</sup><span class="mq-scaled"><span class="mq-sqrt-prefix mq-scaled">&radic;</span><span class="mq-sqrt-stem mq-non-leaf">&1</span></span>',t.textTemplate=["sqrt[","](",")"],t.latex=function(){return"\\sqrt["+this.ends[xt].latex()+"]{"+this.ends[yt].latex()+"}"}}),at=qt(qt(k,d),function(t,n){t.init=function(t,e,i,s,r){n.init.call(this,"\\left"+s,g,[e,i]),this.side=t,this.sides={},this.sides[xt]={ch:e,ctrlSeq:s},this.sides[yt]={ch:i,ctrlSeq:r}},t.numBlocks=function(){return 1},t.html=function(){return this.htmlTemplate='<span class="mq-non-leaf"><span class="mq-scaled mq-paren'+(this.side===yt?" mq-ghost":"")+'">'+this.sides[xt].ch+'</span><span class="mq-non-leaf">&0</span><span class="mq-scaled mq-paren'+(this.side===xt?" mq-ghost":"")+'">'+this.sides[yt].ch+"</span></span>",n.html.call(this)},t.latex=function(){return"\\left"+this.sides[xt].ctrlSeq+this.ends[xt].latex()+"\\right"+this.sides[yt].ctrlSeq},t.oppBrack=function(t,e,n){return e instanceof at&&e.side&&e.side!==-n&&("|"===this.sides[this.side].ch||e.side===-this.side)&&(!t.restrictMismatchedBrackets||lt[this.sides[this.side].ch]===e.sides[e.side].ch||{"(":"]","[":")"}[this.sides[xt].ch]===e.sides[yt].ch)&&e},t.closeOpposing=function(t){t.side=0,t.sides[this.side]=this.sides[this.side],t.delimjQs.eq(this.side===xt?0:1).removeClass("mq-ghost").html(this.sides[this.side].ch)},t.createLeftOf=function(t){var e,i,s;this.replacedFragment||(e=t.options,i=this.oppBrack(e,t[xt],xt)||this.oppBrack(e,t[yt],yt)||this.oppBrack(e,t.parent.parent)),i?(s=this.side=-i.side,this.closeOpposing(i),i===t.parent.parent&&t[s]&&(Qt(t[s],t.parent.ends[s],-s).disown().withDirAdopt(-s,i.parent,i,i[s]).jQ.insDirOf(s,i.jQ),i.bubble("reflow"))):(s=(i=this).side,i.replacedFragment?i.side=0:t[-s]&&(i.replaces(Qt(t[-s],t.parent.ends[-s],s)),t[-s]=0),n.createLeftOf.call(i,t)),s===xt?t.insAtLeftEnd(i.ends[xt]):t.insRightOf(i)},t.placeCursor=e,t.unwrap=function(){this.ends[xt].children().disown().adopt(this.parent,this,this[yt]).jQ.insertAfter(this.jQ),this.remove()},t.deleteSide=function(t,e,n){var i,s,r,o=this.parent,a=this[t],l=o.ends[t];if(t===this.side)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));if(i=n.options,s=!this.side,this.side=-t,this.oppBrack(i,this.ends[xt].ends[this.side],t))this.closeOpposing(this.ends[xt].ends[this.side]),r=this.ends[xt].ends[t],this.unwrap(),r.siblingCreated&&r.siblingCreated(n.options,t),a?n.insDirOf(-t,a):n.insAtDirEnd(t,o);else{if(this.oppBrack(i,this.parent.parent,t))this.parent.parent.closeOpposing(this),this.parent.parent.unwrap();else{if(e&&s)return this.unwrap(),void(a?n.insDirOf(-t,a):n.insAtDirEnd(t,o));this.sides[t]={ch:lt[this.sides[this.side].ch],ctrlSeq:lt[this.sides[this.side].ctrlSeq]},this.delimjQs.removeClass("mq-ghost").eq(t===xt?0:1).addClass("mq-ghost").html(this.sides[t].ch)}a?(r=this.ends[xt].ends[t],Qt(a,l,-t).disown().withDirAdopt(-t,this.ends[xt],r,0).jQ.insAtDirEnd(t,this.ends[xt].jQ.removeClass("mq-empty")),r.siblingCreated&&r.siblingCreated(n.options,t),n.insDirOf(-t,a)):e?n.insDirOf(t,this):n.insAtDirEnd(t,this.ends[xt])}},t.deleteTowards=function(t,e){this.deleteSide(-t,!1,e)},t.finalizeTree=function(){this.ends[xt].deleteOutOf=function(t,e){this.parent.deleteSide(t,!0,e)},this.finalizeTree=this.intentionalBlur=function(){this.delimjQs.eq(this.side===xt?1:0).removeClass("mq-ghost"),this.side=0}},t.siblingCreated=function(t,e){e===-this.side&&this.finalizeTree()}}),lt={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{","\\{":"\\}","\\}":"\\{","&lang;":"&rang;","&rang;":"&lang;","\\langle ":"\\rangle ","\\rangle ":"\\langle ","|":"|"},m("("),m("["),m("{","\\{"),Tt.langle=s(at,xt,"&lang;","&rang;","\\langle ","\\rangle "),Tt.rangle=s(at,yt,"&lang;","&rang;","\\langle ","\\rangle "),Ct["|"]=s(at,xt,"|","|","|","|"),Tt.left=qt(k,function(t){t.parser=function(){var t=q.regex,e=q.string,n=(q.succeed,q.optWhitespace);return n.then(t(/^(?:[([|]|\\\{)/)).then(function(i){var s="\\"===i.charAt(0)?i.slice(1):i;return y.then(function(r){return e("\\right").skip(n).then(t(/^(?:[\])|]|\\\})/)).map(function(t){var e="\\"===t.charAt(0)?t.slice(1):t,n=at(0,s,e,i,t);return n.blocks=[r],r.adopt(n,0,0),n})})})}}),Tt.right=qt(k,function(t){t.parser=function(){return q.fail("unmatched \\right")}}),ct=Tt.binom=Tt.binomial=qt(qt(k,d),function(t,e){t.ctrlSeq="\\binom",t.htmlTemplate='<span class="mq-non-leaf"><span class="mq-paren mq-scaled">(</span><span class="mq-non-leaf"><span class="mq-array mq-non-leaf"><span>&0</span><span>&1</span></span></span><span class="mq-paren mq-scaled">)</span></span>',t.textTemplate=["choose(",",",")"]}),Tt.choose=qt(ct,function(t){t.createLeftOf=st.prototype.createLeftOf}),Tt.editable=Tt.MathQuillMathField=qt(k,function(t,e){t.ctrlSeq="\\MathQuillMathField",t.htmlTemplate='<span class="mq-editable-field"><span class="mq-root-block">&0</span></span>',t.parser=function(){var t=this,n=q.string,i=q.regex,s=q.succeed;return n("[").then(i(/^[a-z][a-z0-9]*/i)).skip(n("]")).map(function(e){t.name=e}).or(s()).then(e.parser.call(t))},t.finalizeTree=function(){var t=St(this.ends[xt],this.jQ,Et());t.KIND_OF_MQ="MathField",t.editable=!0,t.createTextarea(),t.editablesTextareaEvents(),t.cursor.insAtRightEnd(t.root),h(t.root)},t.registerInnerField=function(t,e){t.push(t[this.name]=e(this.ends[xt].controller))},t.latex=function(){return this.ends[xt].latex()},t.text=function(){return this.ends[xt].text()}}),ut=Tt.embed=qt(j,function(t,e){t.setOptions=function(t){function e(){return""}return this.text=t.text||e,this.htmlTemplate=t.htmlString||"",this.latex=t.latex||e,this},t.parser=function(){var t=this;return string=q.string,regex=q.regex,succeed=q.succeed,string("{").then(regex(/^[a-z][a-z0-9]*/i)).skip(string("}")).then(function(e){return string("[").then(regex(/^[-\w\s]*/)).skip(string("]")).or(succeed()).map(function(n){return t.setOptions(It[e](n))})})}}),ht=u(1))!function(t,e){"function"==typeof e?(c[t]=function(){return l(),e.apply(this,arguments)},c[t].prototype=e.prototype):c[t]=e}(ft,ht[ft])}();
},{}]},{},["KrXY"], null)
//# sourceMappingURL=/mathquill.min.a54c677f.js.map